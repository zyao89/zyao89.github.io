(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{771:function(t,s,e){"use strict";e.r(s);var n=e(10),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("由于npm依赖中，"),e("code",[t._v("node-gyp")]),t._v(" 编译需要依赖 "),e("code",[t._v("python")]),t._v(" 环境，因此需要重新构建基础镜像。")]),t._v(" "),e("h2",{attrs:{id:"源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源"}},[t._v("#")]),t._v(" 源")]),t._v(" "),e("p",[t._v("依赖安装源 "),e("code",[t._v("sources.list")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("div",{staticClass:"custom-style-wrapper window-controls"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[e("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[e("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),e("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),e("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch main contrib non-free\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch-updates main contrib non-free\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch-updates main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch-backports main contrib non-free\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ stretch-backports main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian-security stretch/updates main contrib non-free\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/debian-security stretch/updates main contrib non-free\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")]),e("CodeResult",{attrs:{lang:"",code:"%23%20%E9%BB%98%E8%AE%A4%E6%B3%A8%E9%87%8A%E4%BA%86%E6%BA%90%E7%A0%81%E9%95%9C%E5%83%8F%E4%BB%A5%E6%8F%90%E9%AB%98%20apt%20update%20%E9%80%9F%E5%BA%A6%EF%BC%8C%E5%A6%82%E6%9C%89%E9%9C%80%E8%A6%81%E5%8F%AF%E8%87%AA%E8%A1%8C%E5%8F%96%E6%B6%88%E6%B3%A8%E9%87%8A%0Adeb%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch%20main%20contrib%20non-free%0A%23%20deb-src%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch%20main%20contrib%20non-free%0Adeb%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch-updates%20main%20contrib%20non-free%0A%23%20deb-src%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch-updates%20main%20contrib%20non-free%0Adeb%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch-backports%20main%20contrib%20non-free%0A%23%20deb-src%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian%2F%20stretch-backports%20main%20contrib%20non-free%0Adeb%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian-security%20stretch%2Fupdates%20main%20contrib%20non-free%0A%23%20deb-src%20http%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fdebian-security%20stretch%2Fupdates%20main%20contrib%20non-free"}})],1),e("h2",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),e("p",[t._v("Dockerfile配置")]),t._v(" "),e("div",{staticClass:"language-dockerfile line-numbers-mode"},[e("div",{staticClass:"custom-style-wrapper window-controls"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[e("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[e("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),e("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),e("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" keymetrics/pm2:10-slim")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sources")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./sources.list /etc/apt/")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# node-gyp require python")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" set -ex "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    && apt-get update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    && apt-get install -y make gcc g++ python "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    && rm -rf /var/lib/apt/lists/*")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 赋予可执行权限")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN mkdir -p /usr/local/lib/node_modules")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN chmod -R 777 /usr/local/lib/node_modules")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集成 vue-cli")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN npm install -g @vue/cli --registry=https://registry.npm.taobao.org --unsafe-perm=true --allow-root")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN npm install -g @vue/cli-service --registry=https://registry.npm.taobao.org --unsafe-perm=true --allow-root")]),t._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bundle APP files")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mkdir -p /home/project")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /home/project")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . /home/project")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" [ "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pm2-runtime"')]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pm2.config.js"')]),t._v(" ]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br")]),e("CodeResult",{attrs:{lang:"dockerfile",code:"FROM%20keymetrics%2Fpm2%3A10-slim%0A%0A%23%20sources%0ACOPY%20.%2Fsources.list%20%2Fetc%2Fapt%2F%0A%0A%23%20node-gyp%20require%20python%0ARUN%20set%20-ex%20%5C%0A%20%20%20%20%26%26%20apt-get%20update%20%5C%0A%20%20%20%20%26%26%20apt-get%20install%20-y%20make%20gcc%20g%2B%2B%20python%20%5C%0A%20%20%20%20%26%26%20rm%20-rf%20%2Fvar%2Flib%2Fapt%2Flists%2F*%0A%0A%23%20%E8%B5%8B%E4%BA%88%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90%0A%23%20RUN%20mkdir%20-p%20%2Fusr%2Flocal%2Flib%2Fnode_modules%0A%23%20RUN%20chmod%20-R%20777%20%2Fusr%2Flocal%2Flib%2Fnode_modules%0A%0A%23%20%E9%9B%86%E6%88%90%20vue-cli%0A%23%20RUN%20npm%20install%20-g%20%40vue%2Fcli%20--registry%3Dhttps%3A%2F%2Fregistry.npm.taobao.org%20--unsafe-perm%3Dtrue%20--allow-root%0A%23%20RUN%20npm%20install%20-g%20%40vue%2Fcli-service%20--registry%3Dhttps%3A%2F%2Fregistry.npm.taobao.org%20--unsafe-perm%3Dtrue%20--allow-root%0A%0A%0A%23%20Bundle%20APP%20files%0ARUN%20mkdir%20-p%20%2Fhome%2Fproject%0AWORKDIR%20%2Fhome%2Fproject%0ACOPY%20.%20%2Fhome%2Fproject%0A%0ACMD%20%5B%20%22pm2-runtime%22%2C%20%22pm2.config.js%22%20%5D"}})],1)])}),[],!1,null,null,null);s.default=r.exports}}]);