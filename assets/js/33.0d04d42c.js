(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{691:function(t,s,e){t.exports=e.p+"assets/img/server.2282d5ba.png"},692:function(t,s,e){t.exports=e.p+"assets/file/posts/网络/OpenVPN基本配置/demo/openvpn-install.sh"},820:function(t,s,e){"use strict";e.r(s);var r=e(10),a=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"需求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),r("p",[t._v("通过 OpenVPN 实现无公网IP的内网穿透。")]),t._v(" "),r("p",[t._v("内网穿透方法很多，常用得有ngrok，frp，花生壳等。我选择OpenVpn主要是安全性更好点。花生壳、ngrok和frp，实现得内网穿透。知道你域名或者外网IP就能直接连到你得对应机器得端口上。"),r("br"),t._v("\n而openvpn方式有点不一样。A服务器运行server，B客户机运行client连接A服务器，C客户机运行client连接A服务器。然后B就能直接与C通信。")]),t._v(" "),r("p",[t._v("其中只要 A服务器 拥有公网IP即可。")]),t._v(" "),r("p",[r("img",{attrs:{src:e(691),alt:"简单的架构图"}})]),t._v(" "),r("h2",{attrs:{id:"搭建server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#搭建server"}},[t._v("#")]),t._v(" 搭建server")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://git.io/vpn -O openvpn-install.sh "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" openvpn-install.sh\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"wget%20https%3A%2F%2Fgit.io%2Fvpn%20-O%20openvpn-install.sh%20%26%26%20bash%20openvpn-install.sh"}})],1),r("p",[t._v("备用地址")]),t._v(" "),r("blockquote",[r("p",[t._v("wget "+t._s(t.$withDemoBase(e(692)))+" -O openvpn-install.sh && bash openvpn-install.sh")])]),t._v(" "),r("p",[t._v("一键傻瓜式，只要填入相关信息就可搭建成功。")]),t._v(" "),r("h2",{attrs:{id:"配置调整"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置调整"}},[t._v("#")]),t._v(" 配置调整")]),t._v(" "),r("p",[t._v("其实任何东西都不修改的情况下，客户机直接使用生成的client.ovpn即可跑起来了。"),r("br"),t._v("\n不过这样的话。所有流量都是走的服务器上，对于我来说。只是想要B和C能通信，并不需要全局走openvpn。那么需要修改下2个东西即可。")]),t._v(" "),r("h2",{attrs:{id:"修改server-ovpn"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#修改server-ovpn"}},[t._v("#")]),t._v(" 修改server.ovpn")]),t._v(" "),r("p",[t._v("在 "),r("code",[t._v("/etc/openvpn/server.conf")]),t._v(" 文件中，注释掉以下这一行")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# push "redirect-gateway def1 bypass-dhcp"')]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20push%20%22redirect-gateway%20def1%20bypass-dhcp%22"}})],1),r("h2",{attrs:{id:"修改client-ovpn"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#修改client-ovpn"}},[t._v("#")]),t._v(" 修改client.ovpn")]),t._v(" "),r("p",[t._v("在生成的 "),r("code",[t._v("client.ovpn")]),t._v(" 文件中，注释掉这一行")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# setenv opt block-outside-dns")]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20setenv%20opt%20block-outside-dns"}})],1),r("p",[t._v("或者")]),t._v(" "),r("p",[t._v("在 "),r("code",[t._v("/etc/openvpn/client-template.txt")]),t._v(" 模版文件中，注释掉这一行")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# setenv opt block-outside-dns")]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20setenv%20opt%20block-outside-dns"}})],1),r("h2",{attrs:{id:"最后"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),r("p",[t._v("修改后，所有流量还是正常走本地，但是B和C可以使用openvpn分配的内网IP进行通信。")]),t._v(" "),r("p",[t._v("至于用途，比如用ipad连上openvpn后。就可以直接访问家里PC的后台服务等等。")]),t._v(" "),r("h2",{attrs:{id:"其它"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[t._v("#")]),t._v(" 其它")]),t._v(" "),r("h3",{attrs:{id:"区分用户配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#区分用户配置"}},[t._v("#")]),t._v(" 区分用户配置")]),t._v(" "),r("p",[t._v("可以根据客户端用户名区分配置，例如：")]),t._v(" "),r("p",[t._v("在 "),r("code",[t._v("/etc/openvpn/")]),t._v(" 目录下创建 "),r("code",[t._v("ccd")]),t._v(" 文件夹，可以根据不同的用户名创建相应的配置文件")]),t._v(" "),r("p",[t._v("创建用户名对应的文件，并编辑内容：")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分配固定的ip")]),t._v("\nifconfig-push "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.20 "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".255.0\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送当前客户端下的路由段")]),t._v("\npush "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"route 192.168.1.0 255.255.255.0"')]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20%E5%88%86%E9%85%8D%E5%9B%BA%E5%AE%9A%E7%9A%84ip%0Aifconfig-push%2010.8.0.20%20255.255.255.0%0A%23%20%E6%8E%A8%E9%80%81%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E7%9A%84%E8%B7%AF%E7%94%B1%E6%AE%B5%0Apush%20%22route%20192.168.1.0%20255.255.255.0%22"}})],1),r("h4",{attrs:{id:"例如"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#例如"}},[t._v("#")]),t._v(" 例如")]),t._v(" "),r("p",[t._v("客户端 A，提供了 "),r("code",[t._v("192.168.1.0/24")]),t._v(" 网段，则可增加配置 "),r("code",[t._v("/etc/openvpn/ccd/clientA")])]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分配固定的ip")]),t._v("\nifconfig-push "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.100 "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".255.0\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送当前客户端下的路由段")]),t._v("\npush "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"route 192.168.1.0 255.255.255.0"')]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20%E5%88%86%E9%85%8D%E5%9B%BA%E5%AE%9A%E7%9A%84ip%0Aifconfig-push%2010.8.0.100%20255.255.255.0%0A%23%20%E6%8E%A8%E9%80%81%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E7%9A%84%E8%B7%AF%E7%94%B1%E6%AE%B5%0Apush%20%22route%20192.168.1.0%20255.255.255.0%22"}})],1),r("p",[t._v("同理，客户端 B，提供了 "),r("code",[t._v("192.168.2.0/24")]),t._v(" 网段，则可增加配置 "),r("code",[t._v("/etc/openvpn/ccd/clientB")])]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分配固定的ip")]),t._v("\nifconfig-push "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.110 "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".255.0\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送当前客户端下的路由段")]),t._v("\npush "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"route 192.168.2.0 255.255.255.0"')]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"%23%20%E5%88%86%E9%85%8D%E5%9B%BA%E5%AE%9A%E7%9A%84ip%0Aifconfig-push%2010.8.0.110%20255.255.255.0%0A%23%20%E6%8E%A8%E9%80%81%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E7%9A%84%E8%B7%AF%E7%94%B1%E6%AE%B5%0Apush%20%22route%20192.168.2.0%20255.255.255.0%22"}})],1),r("p",[t._v("这时候 客户端A 下的网络就可以访问到 客户端B 下的内网网络了。")]),t._v(" "),r("h3",{attrs:{id:"查看当前链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看当前链接"}},[t._v("#")]),t._v(" 查看当前链接")]),t._v(" "),r("p",[t._v("在 "),r("code",[t._v("/var/log/openvpn/")]),t._v(" 文件下可查看当前接入的输出日志")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("div",{staticClass:"custom-style-wrapper window-controls"},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"14",viewBox:"0 0 54 14"}},[r("g",{attrs:{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)"}},[r("circle",{attrs:{cx:"6",cy:"6",r:"6",fill:"#FF5F56",stroke:"#E0443E","stroke-width":".5"}}),r("circle",{attrs:{cx:"26",cy:"6",r:"6",fill:"#FFBD2E",stroke:"#DEA123","stroke-width":".5"}}),r("circle",{attrs:{cx:"46",cy:"6",r:"6",fill:"#27C93F",stroke:"#1AAB29","stroke-width":".5"}})])])]),r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/log/openvpn/status.log\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("CodeResult",{attrs:{lang:"sh",code:"cat%20%2Fvar%2Flog%2Fopenvpn%2Fstatus.log"}})],1),r("p",[t._v("参考：")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://caibaoz.com/blog/2014/12/21/openvpn-connect-two-lans-asus-ac87u/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://caibaoz.com/blog/2014/12/21/openvpn-connect-two-lans-asus-ac87u/"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://caibaoz.com/blog/2015/07/12/openvpn-connect-two-lans-windows/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://caibaoz.com/blog/2015/07/12/openvpn-connect-two-lans-windows/"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://zlxdike.github.io/2019/04/28/OpenVpn%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zlxdike.github.io/2019/04/28/OpenVpn内网穿透/"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=a.exports}}]);